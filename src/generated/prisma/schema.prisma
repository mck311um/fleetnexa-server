model Service {
  id            String          @id @default(dbgenerated("gen_random_uuid()"))
  service       String
  description   String
  icon          String?
  TenantService TenantService[]
}

model ChargeType {
  id         String   @id @default(dbgenerated("gen_random_uuid()"))
  chargeType String
  unit       String
  rentals    Rental[]
}

model VehicleBrand {
  id      String         @id @default(dbgenerated("gen_random_uuid()"))
  brand   String         @unique
  vehicle Vehicle[]
  models  VehicleModel[]
}

model VehicleModel {
  id       String           @id @default(dbgenerated("gen_random_uuid()"))
  model    String
  brandId  String
  typeId   String?
  vehicles Vehicle[]
  brand    VehicleBrand     @relation(fields: [brandId], references: [id])
  bodyType VehicleBodyType? @relation(fields: [typeId], references: [id])

  @@unique([model, brandId, typeId])
}

model VehicleBodyType {
  id       String         @id @default(dbgenerated("gen_random_uuid()"))
  bodyType String         @unique
  models   VehicleModel[]
}

model VehicleStatus {
  id       String    @id @default(dbgenerated("gen_random_uuid()"))
  status   String    @unique
  vehicles Vehicle[]
}

model FuelType {
  id      String    @id @default(dbgenerated("gen_random_uuid()"))
  fuel    String
  Vehicle Vehicle[]
}

model Transmission {
  id               String    @id @default(dbgenerated("gen_random_uuid()"))
  transmission     String
  transmissionCode String?
  vehicles         Vehicle[]
}

model VehicleFeature {
  id       String    @id @default(dbgenerated("gen_random_uuid()"))
  feature  String
  vehicles Vehicle[] @relation("VehicleToVehicleFeature")
}

model WheelDrive {
  id       String    @id @default(dbgenerated("gen_random_uuid()"))
  drive    String
  code     String
  vehicles Vehicle[]
}

model InvoiceSequence {
  id      String   @id @default(dbgenerated("gen_random_uuid()"))
  prefix  String
  example String
  Tenant  Tenant[]
}

model Country {
  id                 String            @id @default(dbgenerated("gen_random_uuid()"))
  code               String            @unique
  country            String            @unique
  createdAt          DateTime          @default(now())
  updatedBy          String?
  addresses          Address[]
  caribbeanCountries CaribbeanCountry?
  adminUser          AdminUser?        @relation(fields: [updatedBy], references: [username])
  customerAddresses  CustomerAddress[]
  driverLicenses     DriverLicense[]
  licenseClasses     LicenseClass[]
  ports              Port[]
  presetLocations    PresetLocation[]
  states             State[]
  storefrontUser     StorefrontUser[]
}

model State {
  id                String            @id @default(dbgenerated("gen_random_uuid()"))
  countryId         String
  state             String
  geoNameId         Int?              @unique
  addresses         Address[]
  customerAddresses CustomerAddress[]
  presetLocations   PresetLocation[]
  country           Country           @relation(fields: [countryId], references: [id])
  storefrontUser    StorefrontUser[]
  villages          Village[]
}

model Village {
  id                String            @id @default(dbgenerated("gen_random_uuid()"))
  stateId           String
  village           String
  geoNameId         Int?              @unique
  addresses         Address[]
  customerAddresses CustomerAddress[]
  presetLocations   PresetLocation[]
  storefrontUser    StorefrontUser[]
  state             State             @relation(fields: [stateId], references: [id])
}

model MaintenanceService {
  id                 String                   @id @default(dbgenerated("gen_random_uuid()"))
  service            String
  description        String
  serviceLog         VehicleServiceLog[]
  serviceSchedule    VehicleServiceSchedule[]
  vehicleMaintenance VehicleMaintenance[]     @relation("MaintenanceToServices")
}

model DocumentType {
  id               String             @id @default(dbgenerated("gen_random_uuid()"))
  type             String
  customerDocument CustomerDocument[]
}

model PresetLocation {
  id        String  @id @default(dbgenerated("gen_random_uuid()"))
  location  String
  street    String
  villageId String
  stateId   String
  countryId String
  country   Country @relation(fields: [countryId], references: [id])
  state     State   @relation(fields: [stateId], references: [id])
  village   Village @relation(fields: [villageId], references: [id])
}

model LicenseClass {
  id            String          @id @default(dbgenerated("gen_random_uuid()"))
  class         String
  name          String
  description   String
  countryId     String
  DriverLicense DriverLicense[]
  country       Country         @relation(fields: [countryId], references: [id])
}

model MessengerApp {
  id           String                 @id @default(dbgenerated("gen_random_uuid()"))
  app          String
  icon         String
  customerApps CustomerMessengerApp[]
}

model Equipment {
  id               String            @id @default(dbgenerated("gen_random_uuid()"))
  equipment        String
  description      String
  icon             String?
  tenantEquipments TenantEquipment[]
}

model ContactType {
  id             String          @id @default(dbgenerated("gen_random_uuid()"))
  type           String
  tenantContacts TenantContact[]
}

model PaymentType {
  id          String    @id @default(dbgenerated("gen_random_uuid()"))
  type        String
  description String
  payments    Payment[]
}

model VendorType {
  id   String @id @default(dbgenerated("gen_random_uuid()"))
  type String
}

model Port {
  id        String       @id @default(dbgenerated("gen_random_uuid()"))
  port      String
  type      PortType
  countryId String
  country   Country      @relation(fields: [countryId], references: [id])
  vessels   VesselInfo[]
}

model Customer {
  id             String                 @id @default(dbgenerated("gen_random_uuid()"))
  firstName      String
  lastName       String
  gender         String
  dateOfBirth    DateTime
  email          String?
  phone          String
  tenantId       String
  profileImage   String?
  status         CustomerStatus         @default(ACTIVE)
  experience     Int?
  isActive       Boolean                @default(false)
  isDeleted      Boolean                @default(false)
  createdAt      DateTime               @default(now())
  updatedAt      DateTime?              @updatedAt
  updatedBy      String?
  storefrontId   String?
  storefrontUser StorefrontUser?        @relation(fields: [storefrontId], references: [id])
  tenant         Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  address        CustomerAddress?
  documents      CustomerDocument?
  apps           CustomerMessengerApp[]
  violations     CustomerViolation[]
  license        DriverLicense?
  invoices       Invoice[]
  payments       Payment[]
  refunds        Refund[]
  rentalActivity RentalActivity[]
  agreements     RentalAgreement[]
  charges        RentalCharge[]
  drivers        RentalDriver[]
  damages        VehicleDamage[]

  @@unique([tenantId, storefrontId])
}

model CustomerMessengerApp {
  id           String       @id @default(dbgenerated("gen_random_uuid()"))
  customerId   String
  appId        String
  account      String
  createdAt    DateTime     @default(now())
  updatedAt    DateTime?    @updatedAt
  messengerApp MessengerApp @relation(fields: [appId], references: [id])
  customer     Customer     @relation(fields: [customerId], references: [id])
}

model CustomerAddress {
  id         String    @id @default(dbgenerated("gen_random_uuid()"))
  street     String?
  countryId  String?
  customerId String    @unique
  createdAt  DateTime  @default(now())
  updatedAt  DateTime? @updatedAt
  stateId    String?
  villageId  String?
  country    Country?  @relation(fields: [countryId], references: [id])
  customer   Customer  @relation(fields: [customerId], references: [id])
  state      State?    @relation(fields: [stateId], references: [id])
  village    Village?  @relation(fields: [villageId], references: [id])
}

model CustomerDocument {
  id             String       @id @default(dbgenerated("gen_random_uuid()"))
  documentId     String
  customerId     String       @unique
  documentNumber String
  issuedDate     DateTime
  expiryDate     DateTime
  createdAt      DateTime     @default(now())
  updatedAt      DateTime?    @updatedAt
  createdBy      String?
  updatedBy      String?
  documents      String[]
  notes          String?
  customer       Customer     @relation(fields: [customerId], references: [id])
  document       DocumentType @relation(fields: [documentId], references: [id])
}

model DriverLicense {
  id            String        @id @default(dbgenerated("gen_random_uuid()"))
  classId       String?
  countryId     String?
  customerId    String        @unique
  licenseNumber String        @unique
  licenseExpiry DateTime
  licenseIssued DateTime?
  image         String?
  class         LicenseClass? @relation(fields: [classId], references: [id])
  country       Country?      @relation(fields: [countryId], references: [id])
  customer      Customer      @relation(fields: [customerId], references: [id])
}

model CustomerViolation {
  id            String          @id @default(dbgenerated("gen_random_uuid()"))
  violationId   String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime?       @updatedAt
  createdBy     String?
  updatedBy     String?
  customerId    String
  tenantId      String
  notes         String?
  violationDate DateTime
  deletedAt     DateTime?
  isDeleted     Boolean         @default(false)
  customer      Customer        @relation(fields: [customerId], references: [id])
  tenant        Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  violation     TenantViolation @relation(fields: [violationId], references: [id])
}

enum Severity {
  MINOR
  MODERATE
  SEVERE
  CRITICAL
}

enum Agent {
  MANUAL
  RENTNEXA
  PARTNER
  SYSTEM
  STOREFRONT
}

enum CustomerStatus {
  ACTIVE
  INACTIVE
  BANNED
  BLACKLISTED
}

enum DamageLocation {
  INTERIOR
  EXTERIOR
}

enum ExtraType {
  INSURANCE
  EQUIPMENT
}

enum PricePolicy {
  FIXED_AMOUNT
  PERCENTAGE
  DAILY_PRICE
  FLAT_RATE
}

enum SubscriptionStatus {
  PENDING
  TRIAL
  ACTIVE
  SUSPENDED
  CANCELED
}

enum RentalStatus {
  PENDING
  CONFIRMED
  RESERVED
  ACTIVE
  COMPLETED
  DECLINED
  CANCELED
  NO_SHOW
  REFUNDED
  EXPIRED
}

enum MaintenanceStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELED
}

enum RentalAction {
  BOOKED
  CANCELED
  RETURNED
  EXTENDED
  PICKED_UP
}

enum StatItem {
  TOTAL_REVENUE
  NEW_RENTALS
  RENTED_VEHICLES
  AVAILABLE_VEHICLES
  TOTAL_CUSTOMERS
  AVERAGE_RENTAL
  MONTHLY_EARNINGS
  MONTHLY_RENTALS
  MONTHLY_RENTAL_STATUS
  YEARLY_REVENUE
  YEARLY_RENTALS
  YEARLY_CUSTOMERS
  AVERAGE_RENTAL_DURATION
  YEARLY_EXPENSES
}

enum TransactionType {
  RENTAL
  REFUND
  PAYMENT
  EXPENSE
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
}

enum NotificationType {
  BOOKING
  UPCOMING
  RETURN
  UNCONFIRMED
  PAYMENT
  REFUND
  GENERAL
}

enum PortType {
  SEA
  AIR
}

enum DirectionType {
  ARRIVAL
  DEPARTURE
}

enum VesselType {
  SHIP
  PLANE
  OTHER
}

enum BillingPeriod {
  MONTHLY
  YEARLY
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
}

model CaribbeanCountry {
  id          String  @id @default(dbgenerated("gen_random_uuid()"))
  countryId   String  @unique
  image       String
  isActive    Boolean @default(false)
  description String  @default("")
  country     Country @relation(fields: [countryId], references: [id], onDelete: Cascade)
}

model ShopDMMerchant {
  id              String @id @default(dbgenerated("gen_random_uuid()"))
  tenantId        String @unique
  merchant_handle String
  merchant_secret String
  tenant          Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Currency {
  id            String               @id @default(dbgenerated("gen_random_uuid()"))
  code          String               @unique
  currency      String?
  symbol        String?
  bases         ExchangeRate[]       @relation("BaseCurrency")
  targets       ExchangeRate[]       @relation("TargetCurrency")
  payments      Payment[]
  tenants       Tenant[]
  currencyRates TenantCurrencyRate[]
}

model TenantCurrencyRate {
  id         String    @id @default(dbgenerated("gen_random_uuid()"))
  tenantId   String
  currencyId String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime? @updatedAt
  enabled    Boolean   @default(true)
  fromRate   Float?    @default(0.0)
  toRate     Float?    @default(0.0)
  currency   Currency  @relation(fields: [currencyId], references: [id])
  tenant     Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, currencyId])
}

model ExchangeRate {
  id             String    @id @default(dbgenerated("gen_random_uuid()"))
  base           String
  target         String
  rate           Float
  updatedAt      DateTime? @updatedAt
  createdAt      DateTime  @default(now())
  baseCurrency   Currency  @relation("BaseCurrency", fields: [base], references: [code])
  targetCurrency Currency  @relation("TargetCurrency", fields: [target], references: [code])

  @@unique([base, target])
}

model Form {
  id        String        @id @default(dbgenerated("gen_random_uuid()"))
  tenantId  String
  type      FormType
  expiresAt DateTime?
  submitted Boolean       @default(false)
  createdAt DateTime      @default(now())
  updatedAt DateTime?     @updatedAt
  tenant    Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  response  FormResponse?
}

model FormResponse {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  formId      String   @unique
  data        Json
  submittedAt DateTime @default(now())
  form        Form     @relation(fields: [formId], references: [id])
}

enum FormType {
  customer_info
  driver_registration
  vehicle_inspection
}

model RentalActivity {
  id         String       @id @default(dbgenerated("gen_random_uuid()"))
  customerId String
  rentalId   String
  action     RentalAction
  vehicleId  String
  createdAt  DateTime     @default(now())
  createdBy  String?
  tenantId   String
  customer   Customer     @relation(fields: [customerId], references: [id])
  rental     Rental       @relation(fields: [rentalId], references: [id])
  tenant     Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vehicle    Vehicle      @relation(fields: [vehicleId], references: [id])
}

model TenantNotification {
  id          String                   @id @default(dbgenerated("gen_random_uuid()"))
  title       String
  type        NotificationType
  priority    NotificationPriority
  message     String
  tenantId    String
  actionUrl   String?
  createdAt   DateTime                 @default(now())
  isDeleted   Boolean                  @default(false)
  readByUsers NotificationReadStatus[]
  tenant      Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model NotificationReadStatus {
  id             String             @id @default(dbgenerated("gen_random_uuid()"))
  notificationId String
  userId         String
  readAt         DateTime           @default(now())
  notification   TenantNotification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([notificationId, userId])
}

model AppPermission {
  id              String               @id @default(dbgenerated("gen_random_uuid()"))
  name            String               @unique
  description     String?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime?            @updatedAt
  categoryId      String?
  category        PermissionCategory?  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  rolePermissions UserRolePermission[]
}

model PermissionCategory {
  id          String             @id @default(dbgenerated("gen_random_uuid()"))
  name        String             @unique
  description String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime?          @updatedAt
  permissions AppPermission[]
  plans       SubscriptionPlan[] @relation("PlanPermissionCategories")
}

model Rental {
  id                String             @id @default(dbgenerated("gen_random_uuid()"))
  rentalNumber      String?
  startDate         DateTime
  endDate           DateTime
  pickupLocationId  String
  returnLocationId  String
  vehicleId         String
  agent             Agent
  createdAt         DateTime           @default(now())
  updatedAt         DateTime?          @updatedAt
  tenantId          String
  status            RentalStatus       @default(PENDING)
  createdBy         String?
  updatedBy         String?
  notes             String?
  isDeleted         Boolean            @default(false)
  chargeTypeId      String?
  bookingCode       String?            @unique
  deletedAt         DateTime?
  invoice           Invoice?
  payments          Payment[]
  refunds           Refund[]
  chargeType        ChargeType?        @relation(fields: [chargeTypeId], references: [id])
  user              User?              @relation(fields: [createdBy], references: [id])
  pickup            TenantLocation     @relation("PickupLocation", fields: [pickupLocationId], references: [id])
  return            TenantLocation     @relation("ReturnLocation", fields: [returnLocationId], references: [id])
  tenant            Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vehicle           Vehicle            @relation(fields: [vehicleId], references: [id])
  rentalActivity    RentalActivity[]
  agreement         RentalAgreement?
  charges           RentalCharge[]
  drivers           RentalDriver[]
  storefrontBooking StorefrontBooking?
  transactions      Transactions[]
  values            Values?
  vessels           VesselInfo[]
}

model StorefrontBooking {
  id        String         @id @default(dbgenerated("gen_random_uuid()"))
  rentalId  String         @unique
  userId    String
  createdAt DateTime       @default(now())
  updatedAt DateTime?      @updatedAt
  rental    Rental         @relation(fields: [rentalId], references: [id])
  user      StorefrontUser @relation(fields: [userId], references: [id])
}

model RentalDriver {
  id        String   @id @default(dbgenerated("gen_random_uuid()"))
  rentalId  String
  driverId  String
  isPrimary Boolean  @default(false)
  customer  Customer @relation(fields: [driverId], references: [id])
  rental    Rental   @relation(fields: [rentalId], references: [id])

  @@unique([rentalId, driverId], name: "rentalId_driverId")
}

model Invoice {
  id            String    @id @default(dbgenerated("gen_random_uuid()"))
  invoiceNumber String
  amount        Float
  rentalId      String    @unique
  tenantId      String
  customerId    String
  status        String    @default("pending")
  invoiceUrl    String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime? @updatedAt
  createdBy     String?
  updatedBy     String?
  customer      Customer  @relation(fields: [customerId], references: [id])
  rental        Rental    @relation(fields: [rentalId], references: [id])
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model RentalAgreement {
  id           String    @id @default(dbgenerated("gen_random_uuid()"))
  number       String
  rentalId     String    @unique
  tenantId     String
  customerId   String
  agreementUrl String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime? @updatedAt
  createdBy    String?
  updatedBy    String?
  signableUrl  String?
  customer     Customer  @relation(fields: [customerId], references: [id])
  rental       Rental    @relation(fields: [rentalId], references: [id])
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Values {
  id                   String        @id @default(dbgenerated("gen_random_uuid()"))
  numberOfDays         Int
  basePrice            Float
  totalCost            Float
  discount             Float
  deliveryFee          Float
  collectionFee        Float
  deposit              Float
  totalExtras          Float
  subTotal             Float
  netTotal             Float
  rentalId             String        @unique
  discountAmount       Float
  discountPolicy       String
  createdAt            DateTime      @default(now())
  updatedAt            DateTime?     @updatedAt
  additionalDriverFees Float         @default(0.0)
  cancellationFee      Float         @default(0.0)
  lateFee              Float         @default(0.0)
  customBasePrice      Boolean       @default(false)
  customCollectionFee  Boolean       @default(false)
  customDeliveryFee    Boolean       @default(false)
  customDeposit        Boolean       @default(false)
  customDiscount       Boolean       @default(false)
  customTotalCost      Boolean       @default(false)
  extras               RentalExtra[]
  rental               Rental        @relation(fields: [rentalId], references: [id])
}

model RentalExtra {
  id           String  @id @default(dbgenerated("gen_random_uuid()"))
  extraId      String
  amount       Float
  valuesId     String
  customAmount Boolean @default(false)
  values       Values  @relation(fields: [valuesId], references: [id])
}

model RentalCharge {
  id         String   @id @default(dbgenerated("gen_random_uuid()"))
  rentalId   String
  charge     String
  reason     String?
  amount     Float
  customerId String
  tenantId   String
  createdAt  DateTime @default(now())
  customer   Customer @relation(fields: [customerId], references: [id])
  rental     Rental   @relation(fields: [rentalId], references: [id])
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model VesselInfo {
  id        String        @id @default(dbgenerated("gen_random_uuid()"))
  bookingId String
  portId    String
  direction DirectionType
  type      VesselType
  carrier   String
  number    String
  arrival   DateTime?
  departure DateTime?
  notes     String?
  booking   Rental        @relation(fields: [bookingId], references: [id])
  port      Port          @relation(fields: [portId], references: [id])
}

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TenantWeeklyStats {
  id        String   @id @default(dbgenerated("gen_random_uuid()"))
  tenantId  String
  week      Int
  year      Int
  stat      StatItem
  value     Float
  startDate DateTime
  endDate   DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, week, year, stat])
}

model TenantYearlyStats {
  id        String   @id @default(dbgenerated("gen_random_uuid()"))
  tenantId  String
  year      Int
  stat      StatItem
  value     Float
  startDate DateTime
  endDate   DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, year, stat])
}

model TenantMonthlyStats {
  id        String   @id @default(dbgenerated("gen_random_uuid()"))
  tenantId  String
  month     Int
  year      Int
  stat      StatItem
  value     Float
  startDate DateTime
  endDate   DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, month, year, stat])
}

model TenantMonthlyRentalStats {
  id        String       @id @default(dbgenerated("gen_random_uuid()"))
  tenantId  String
  month     Int
  year      Int
  stat      StatItem
  status    RentalStatus
  value     Float
  startDate DateTime
  endDate   DateTime
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  tenant    Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, status, month, year, stat])
}

model TenantRatings {
  id        Int      @id @default(autoincrement())
  tenantId  String
  rating    Float    @default(0.0)
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String
  fullName  String
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model SiteRatings {
  id        Int      @id @default(autoincrement())
  fullName  String
  email     String
  rating    Float    @default(0.0)
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SubscriptionPlan {
  id                 String               @id @default(dbgenerated("gen_random_uuid()"))
  description        String?
  name               String               @unique
  planCode           String?              @unique
  planId             String?              @unique
  period             BillingPeriod        @default(MONTHLY)
  price              Float                @default(0)
  details            PlanDetails?
  features           PlanFeatures[]
  tenantSubscription TenantSubscription[]
  categories         PermissionCategory[] @relation("PlanPermissionCategories")
}

model PlanFeatures {
  id      String           @id @default(dbgenerated("gen_random_uuid()"))
  planId  String
  feature String
  plan    SubscriptionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)
}

model PlanDetails {
  id       String           @id @default(dbgenerated("gen_random_uuid()"))
  planId   String           @unique
  users    Int
  vehicles Int
  plan     SubscriptionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)
}

model Tenant {
  id                   String                     @id @default(dbgenerated("gen_random_uuid()"))
  tenantCode           String                     @unique
  tenantName           String
  email                String                     @unique
  number               String                     @unique
  currencyId           String?
  createdAt            DateTime                   @default(now())
  updatedAt            DateTime?                  @updatedAt
  logo                 String?
  setupCompleted       Boolean                    @default(false)
  financialYearStart   String                     @default("January")
  invoiceSequenceId    String?
  invoiceFootNotes     String                     @default("")
  storefrontEnabled    Boolean                    @default(false)
  subscriptionId       String?
  securityDeposit      Float                      @default(0)
  rating               Float                      @default(0)
  description          String?                    @default("")
  cancellationPolicyId String?                    @unique
  latePolicyId         String?                    @unique
  additionalDriverFee  Float                      @default(0)
  daysInMonth          Int                        @default(28)
  slug                 String?                    @unique
  merchantId           String?
  businessVerified     Boolean                    @default(false)
  emailVerified        Boolean                    @default(false)
  isDeleted            Boolean                    @default(false)
  endTime              String?                    @default("11:30 PM")
  startTime            String?                    @default("12:00 AM")
  address              Address?
  customers            Customer[]
  customerViolations   CustomerViolation[]
  emailTokens          EmailVerification[]
  expenses             Expense[]
  forms                Form[]
  invoices             Invoice[]
  payments             Payment[]
  refunds              Refund[]
  rentals              Rental[]
  rentalActivity       RentalActivity[]
  agreements           RentalAgreement[]
  charges              RentalCharge[]
  merchant             ShopDMMerchant?
  cancellationPolicy   CancellationPolicy?        @relation(fields: [cancellationPolicyId], references: [id], onDelete: Cascade)
  currency             Currency?                  @relation(fields: [currencyId], references: [id], onDelete: Cascade)
  invoiceSequence      InvoiceSequence?           @relation(fields: [invoiceSequenceId], references: [id], onDelete: Cascade)
  latePolicy           LatePolicy?                @relation(fields: [latePolicyId], references: [id], onDelete: Cascade)
  contacts             TenantContact[]
  currencyRates        TenantCurrencyRate[]
  equipment            TenantEquipment[]
  insurance            TenantInsurance[]
  tenantLocations      TenantLocation[]
  monthlyRentalStats   TenantMonthlyRentalStats[]
  monthlyStats         TenantMonthlyStats[]
  notifications        TenantNotification[]
  ratings              TenantRatings[]
  reminders            TenantReminders[]
  services             TenantService[]
  subscription         TenantSubscription?
  vendors              TenantVendor[]
  violations           TenantViolation[]
  weeklyStats          TenantWeeklyStats[]
  yearlyStats          TenantYearlyStats[]
  transactions         Transactions[]
  users                User[]
  userRoles            UserRole[]
  vehicles             Vehicle[]
  maintenance          VehicleMaintenance[]
  verificationRequest  VerificationRequest?
  paymentMethods       PaymentMethod[]            @relation("PaymentMethodToTenant")
}

model EmailVerification {
  id        String   @id @default(dbgenerated("gen_random_uuid()"))
  email     String
  token     String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime
  verified  Boolean  @default(false)
  tenantId  String
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([email])
}

model PaymentMethod {
  id        String    @id @default(dbgenerated("gen_random_uuid()"))
  method    String
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
  payments  Payment[]
  tenant    Tenant[]  @relation("PaymentMethodToTenant")
}

model Address {
  id        String    @id @default(dbgenerated("gen_random_uuid()"))
  street    String?
  countryId String?
  tenantId  String    @unique
  stateId   String?
  villageId String?
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
  country   Country?  @relation(fields: [countryId], references: [id])
  state     State?    @relation(fields: [stateId], references: [id])
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  village   Village?  @relation(fields: [villageId], references: [id])
}

model TenantLocation {
  id                  String    @id @default(dbgenerated("gen_random_uuid()"))
  location            String
  pickupEnabled       Boolean
  returnEnabled       Boolean
  deliveryFee         Float
  collectionFee       Float
  tenantId            String
  minimumRentalPeriod Int       @default(1)
  isDeleted           Boolean   @default(false)
  updatedAt           DateTime? @updatedAt
  updatedBy           String?
  storefrontEnabled   Boolean   @default(false)
  createdAt           DateTime  @default(now())
  pickups             Rental[]  @relation("PickupLocation")
  returns             Rental[]  @relation("ReturnLocation")
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vehicles            Vehicle[]
}

model TenantInsurance {
  id          String      @id @default(dbgenerated("gen_random_uuid()"))
  insurance   String
  description String
  pricePolicy PricePolicy
  price       Float
  tenantId    String
  isActive    Boolean     @default(true)
  isDeleted   Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime?   @updatedAt
  updatedBy   String?
  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model TenantEquipment {
  id          String      @id @default(dbgenerated("gen_random_uuid()"))
  equipmentId String
  pricePolicy PricePolicy
  price       Float
  tenantId    String
  isActive    Boolean     @default(true)
  isDeleted   Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime?   @updatedAt
  updatedBy   String?
  equipment   Equipment   @relation(fields: [equipmentId], references: [id])
  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model TenantService {
  id          String      @id @default(dbgenerated("gen_random_uuid()"))
  serviceId   String
  tenantId    String
  price       Float
  pricePolicy PricePolicy
  isActive    Boolean     @default(false)
  isDeleted   Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime?   @updatedAt
  updatedBy   String?
  service     Service     @relation(fields: [serviceId], references: [id])
  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model TenantSubscription {
  id        String             @id @default(dbgenerated("gen_random_uuid()"))
  tenantId  String             @unique
  status    SubscriptionStatus @default(TRIAL)
  startDate DateTime?
  endDate   DateTime?
  createdAt DateTime           @default(now())
  updatedAt DateTime?          @updatedAt
  planId    String?
  plan      SubscriptionPlan?  @relation(fields: [planId], references: [planId])
  tenant    Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model TenantContact {
  id            String              @id @default(dbgenerated("gen_random_uuid()"))
  name          String
  email         String
  phone         String
  tenantId      String
  contactTypeId String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime?           @updatedAt
  contactType   ContactType         @relation(fields: [contactTypeId], references: [id])
  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  serviceLog    VehicleServiceLog[]
}

model TenantReminders {
  id          String    @id @default(dbgenerated("gen_random_uuid()"))
  reminder    String
  date        DateTime
  tenantId    String
  completed   Boolean   @default(false)
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt
  updatedBy   String?
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model CancellationPolicy {
  id                 String  @id @default(dbgenerated("gen_random_uuid()"))
  minimumDays        Int
  policy             String
  amount             Float
  tenantId           String  @unique
  updatedBy          String?
  bookingMinimumDays Int
  tenant             Tenant?
}

model LatePolicy {
  id        String  @id @default(dbgenerated("gen_random_uuid()"))
  amount    Float
  maxHours  Int
  updatedBy String?
  tenantId  String  @unique
  tenant    Tenant?
}

model TenantViolation {
  id                 String              @id @default(dbgenerated("gen_random_uuid()"))
  violation          String              @unique
  tenantId           String
  description        String?
  amount             Float               @default(0)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime?           @updatedAt
  isDeleted          Boolean             @default(false)
  deletedAt          DateTime?
  customerViolations CustomerViolation[]
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model TenantVendor {
  id                 String               @id @default(dbgenerated("gen_random_uuid()"))
  vendor             String
  tenantId           String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime?            @updatedAt
  updatedBy          String?
  deletedAt          DateTime?
  contactName        String?
  isDeleted          Boolean              @default(false)
  phone              String?
  email              String?
  expenses           Expense[]
  tenant             Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vehicleMaintenance VehicleMaintenance[]
}

model VerificationRequest {
  id           String             @id @default(dbgenerated("gen_random_uuid()"))
  tenantId     String             @unique
  documentType String
  documentUrl  String
  idType       String
  idUrl        String
  status       VerificationStatus @default(PENDING)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime?          @updatedAt
  reviewedAt   DateTime?
  reviewedBy   String?
  tenant       Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Transactions {
  id              String          @id @default(dbgenerated("gen_random_uuid()"))
  amount          Float
  type            TransactionType
  isDeleted       Boolean         @default(false)
  transactionDate DateTime        @default(now())
  createdAt       DateTime        @default(now())
  createdBy       String?
  paymentId       String?         @unique
  tenantId        String
  rentalId        String?
  details         String?
  refundId        String?         @unique
  expenseId       String?         @unique
  updatedAt       DateTime?       @updatedAt
  updatedBy       String?
  user            User?           @relation(fields: [createdBy], references: [username])
  expense         Expense?        @relation(fields: [expenseId], references: [id])
  payment         Payment?        @relation(fields: [paymentId], references: [id])
  refund          Refund?         @relation(fields: [refundId], references: [id])
  rental          Rental?         @relation(fields: [rentalId], references: [id])
  tenant          Tenant          @relation(fields: [tenantId], references: [id])
}

model Payment {
  id              String        @id @default(dbgenerated("gen_random_uuid()"))
  amount          Float
  paymentMethodId String
  paymentTypeId   String
  tenantId        String
  rentalId        String
  notes           String?
  isDeleted       Boolean       @default(false)
  paymentDate     DateTime
  createdAt       DateTime      @default(now())
  updatedAt       DateTime?     @updatedAt
  updatedBy       String?
  customerId      String?
  currencyId      String?
  payer           String?
  payment         String?
  currency        Currency?     @relation(fields: [currencyId], references: [id])
  customer        Customer?     @relation(fields: [customerId], references: [id])
  paymentMethod   PaymentMethod @relation(fields: [paymentMethodId], references: [id])
  paymentType     PaymentType   @relation(fields: [paymentTypeId], references: [id])
  rental          Rental        @relation(fields: [rentalId], references: [id])
  tenant          Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transaction     Transactions?
}

model Refund {
  id          String        @id @default(dbgenerated("gen_random_uuid()"))
  amount      Float
  tenantId    String
  rentalId    String?
  reason      String?
  isDeleted   Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime?     @updatedAt
  refundDate  DateTime      @default(now())
  createdBy   String?
  customerId  String?
  payee       String?
  refund      String?
  payment     String?
  updatedBy   String?
  customer    Customer?     @relation(fields: [customerId], references: [id])
  rental      Rental?       @relation(fields: [rentalId], references: [id])
  tenant      Tenant        @relation(fields: [tenantId], references: [id])
  transaction Transactions?
}

model Expense {
  id            String              @id @default(dbgenerated("gen_random_uuid()"))
  tenantId      String
  vehicleId     String?
  vendorId      String?
  amount        Float
  expenseDate   DateTime
  notes         String?
  isDeleted     Boolean             @default(false)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime?           @updatedAt
  createdBy     String?
  maintenanceId String?
  expense       String?
  payee         String?
  user          User?               @relation(fields: [createdBy], references: [username])
  maintenance   VehicleMaintenance? @relation(fields: [maintenanceId], references: [id])
  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vehicle       Vehicle?            @relation(fields: [vehicleId], references: [id])
  vendor        TenantVendor?       @relation(fields: [vendorId], references: [id])
  Transactions  Transactions?
}

model User {
  id                       String                   @id @default(dbgenerated("gen_random_uuid()"))
  password                 String
  firstName                String
  lastName                 String
  username                 String                   @unique
  tenantId                 String?
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime?                @updatedAt
  roleId                   String?
  lastChanged              DateTime?
  email                    String?                  @unique
  profilePicture           String                   @default("https://fleetnexa.s3.us-east-1.amazonaws.com/Global+Images/fallback.png")
  show                     Boolean                  @default(true)
  deletedAt                DateTime?
  isDeleted                Boolean                  @default(false)
  requirePasswordChange    Boolean                  @default(true)
  expenses                 Expense[]
  notificationReadStatuses NotificationReadStatus[]
  rentals                  Rental[]
  transactions             Transactions[]
  role                     UserRole?                @relation(fields: [roleId], references: [id], onDelete: Cascade)
  tenant                   Tenant?                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([username, tenantId])
}

model StorefrontUser {
  id                  String              @id @default(dbgenerated("gen_random_uuid()"))
  password            String
  firstName           String
  lastName            String
  dateOfBirth         DateTime
  gender              String
  email               String              @unique
  phone               String              @unique
  driverLicenseNumber String              @unique
  licenseExpiry       DateTime
  street              String?
  villageId           String?
  stateId             String?
  countryId           String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime?           @updatedAt
  profilePicture      String?             @default("https://fleetnexa.s3.us-east-1.amazonaws.com/Global+Images/fallback.png")
  licenseIssued       DateTime
  license             String?
  deletedAt           DateTime?
  isDeleted           Boolean             @default(false)
  customers           Customer[]
  bookings            StorefrontBooking[]
  country             Country?            @relation(fields: [countryId], references: [id])
  state               State?              @relation(fields: [stateId], references: [id])
  village             Village?            @relation(fields: [villageId], references: [id])
}

model AdminUser {
  id        String    @id @default(dbgenerated("gen_random_uuid()"))
  password  String
  firstName String
  lastName  String
  email     String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
  username  String    @unique
  countries Country[]
}

model UserRole {
  id             String               @id @default(dbgenerated("gen_random_uuid()"))
  name           String
  description    String?
  tenantId       String
  createdAt      DateTime             @default(now())
  updatedAt      DateTime?            @updatedAt
  isDeleted      Boolean              @default(false)
  updatedBy      String?
  show           Boolean?             @default(true)
  users          User[]
  tenant         Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  rolePermission UserRolePermission[]
}

model UserRolePermission {
  id           String        @id @default(dbgenerated("gen_random_uuid()"))
  roleId       String
  permissionId String
  assignedBy   String?
  assignedAt   DateTime      @default(now())
  permission   AppPermission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         UserRole      @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
}

model EmailTokens {
  id        String   @id @default(dbgenerated("gen_random_uuid()"))
  email     String
  token     String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime
  verified  Boolean  @default(false)
  expired   Boolean  @default(false)

  @@index([email])
}

model Vehicle {
  id                   String                   @id @default(dbgenerated("gen_random_uuid()"))
  year                 Int
  color                String
  licensePlate         String                   @unique
  engineVolume         Int
  vehicleStatusId      String
  fuelTypeId           String
  transmissionId       String
  wheelDriveId         String
  fuelLevel            Int
  odometer             Int
  steering             String                   @default("left")
  featuredImage        String
  images               String[]
  numberOfSeats        Int
  numberOfDoors        Int
  vin                  String
  brandId              String
  modelId              String
  tenantId             String?
  locationId           String?
  isActive             Boolean                  @default(false)
  isDeleted            Boolean                  @default(false)
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime?                @updatedAt
  createdBy            String?
  updatedBy            String?
  drivingExperience    Int                      @default(1)
  fuelPolicyId         String?
  minimumAge           Int
  minimumRental        Int
  refundAmount         Int                      @default(100)
  timeBetweenRentals   Int
  dayPrice             Float                    @default(0)
  monthPrice           Float                    @default(0)
  weekPrice            Float                    @default(0)
  storefrontEnabled    Boolean                  @default(true)
  expenses             Expense[]
  rentals              Rental[]
  rentalActivity       RentalActivity[]
  brand                VehicleBrand             @relation(fields: [brandId], references: [id])
  fuelPolicy           FuelPolicy?              @relation(fields: [fuelPolicyId], references: [id])
  fuelType             FuelType                 @relation(fields: [fuelTypeId], references: [id])
  location             TenantLocation?          @relation(fields: [locationId], references: [id])
  model                VehicleModel             @relation(fields: [modelId], references: [id])
  tenant               Tenant?                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transmission         Transmission             @relation(fields: [transmissionId], references: [id])
  vehicleStatus        VehicleStatus            @relation(fields: [vehicleStatusId], references: [id])
  wheelDrive           WheelDrive               @relation(fields: [wheelDriveId], references: [id])
  damages              VehicleDamage[]
  discounts            VehicleDiscount[]
  scheduledMaintenance VehicleMaintenance[]
  serviceLogs          VehicleServiceLog[]
  scheduledServices    VehicleServiceSchedule[]
  features             VehicleFeature[]         @relation("VehicleToVehicleFeature")
}

model VehicleDiscount {
  id             String    @id @default(dbgenerated("gen_random_uuid()"))
  amount         Decimal   @db.Decimal(10, 2)
  discountPolicy String
  isActive       Boolean   @default(false)
  isDeleted      Boolean   @default(false)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime? @updatedAt
  createdBy      String?
  updatedBy      String?
  vehicleId      String
  deletedAt      DateTime?
  period         Int       @default(1)
  periodPolicy   String    @default("greater_than")
  vehicle        Vehicle   @relation(fields: [vehicleId], references: [id])
}

model VehicleDamage {
  id                  String              @id @default(dbgenerated("gen_random_uuid()"))
  description         String?
  title               String
  isRepaired          Boolean
  severity            Severity            @default(MINOR)
  location            DamageLocation      @default(EXTERIOR)
  estimatedRepairCost Float?
  images              String[]
  partId              String
  vehicleId           String
  repairedAt          DateTime?
  customerId          String?
  isActive            Boolean             @default(false)
  isDeleted           Boolean             @default(false)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime?           @updatedAt
  createdBy           String?
  updatedBy           String?
  customer            Customer?           @relation(fields: [customerId], references: [id])
  vehicle             Vehicle             @relation(fields: [vehicleId], references: [id])
  serviceLogs         VehicleServiceLog[]
}

model VehiclePart {
  id        String    @id @default(dbgenerated("gen_random_uuid()"))
  partName  String
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
}

model FuelPolicy {
  id       String    @id @default(dbgenerated("gen_random_uuid()"))
  policy   String
  code     String
  vehicles Vehicle[]
}

model VehicleServiceLog {
  id                 String                  @id @default(dbgenerated("gen_random_uuid()"))
  vehicleId          String
  serviceId          String
  servicedAt         DateTime
  notes              String?
  contactId          String?
  createdAt          DateTime                @default(now())
  updatedAt          DateTime?               @updatedAt
  updatedBy          String?
  scheduledServiceId String?
  damageId           String?
  cost               Float?
  documents          String[]
  contact            TenantContact?          @relation(fields: [contactId], references: [id])
  damage             VehicleDamage?          @relation(fields: [damageId], references: [id])
  scheduledService   VehicleServiceSchedule? @relation("ScheduleToLogs", fields: [scheduledServiceId], references: [id])
  maintenanceService MaintenanceService      @relation(fields: [serviceId], references: [id])
  vehicle            Vehicle                 @relation(fields: [vehicleId], references: [id])
}

model VehicleMaintenance {
  id        String               @id @default(dbgenerated("gen_random_uuid()"))
  vehicleId String
  vendorId  String?
  startDate DateTime
  endDate   DateTime
  cost      Float
  createdAt DateTime             @default(now())
  updatedAt DateTime?            @updatedAt
  createdBy String?
  updatedBy String?
  isDeleted Boolean              @default(false)
  status    MaintenanceStatus    @default(SCHEDULED)
  tenantId  String?
  expenses  Expense[]
  tenant    Tenant?              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vehicle   Vehicle              @relation(fields: [vehicleId], references: [id])
  vendor    TenantVendor?        @relation(fields: [vendorId], references: [id])
  services  MaintenanceService[] @relation("MaintenanceToServices")
}

model VehicleServiceSchedule {
  id                 String              @id @default(dbgenerated("gen_random_uuid()"))
  vehicleId          String
  serviceId          String
  scheduledDate      DateTime
  isCompleted        Boolean             @default(false)
  serviceLogs        VehicleServiceLog[] @relation("ScheduleToLogs")
  maintenanceService MaintenanceService  @relation(fields: [serviceId], references: [id])
  vehicle            Vehicle             @relation(fields: [vehicleId], references: [id])
}
